name: ğŸ”’ Windows RDP with Tailscale and VS Code

on:
  workflow_dispatch:

jobs:
  rdp:
    runs-on: windows-latest
    
    steps:
      - name: â¬‡ï¸ ÙØ­Øµ (Checkout) Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4

      # ğŸ”‘ 1. ØªÙˆØµÙŠÙ„ Ø¨Ù€ Tailscale
      - name: ğŸ”’ ØªÙˆØµÙŠÙ„ Ø¨Ù€ Tailscale
        uses: tailscale/github-action@v4
        with:
          oauth-client-id: ${{ secrets.TS_OAUTH_CLIENT_ID }}
          oauth-secret: ${{ secrets.TS_OAUTH_SECRET }}
          tags: tag:github-actions 
          hostname: github-rdp-runner

      # âš™ï¸ 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ·Ø¨Ø§Ø¹Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ (ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù‡Ù†Ø§)
      - name: âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ·Ø¨Ø§Ø¹Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
        run: |
          # Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
          $user = "RDP_User"
          $pass = "YourStrongPassword123" 
          net user $user $pass /add
          net localgroup administrators $user /add

          # Ø·Ø¨Ø§Ø¹Ø© Ø¹Ù†ÙˆØ§Ù† IP Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ Tailscale
          $tailscaleIP = (C:\ProgramData\Tailscale\tailscale.exe ip -4)
          
          Write-Host "========================================"
          Write-Host "âœ… ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø´Ø¨ÙƒØ© Tailscale."
          Write-Host "â¬‡ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù€ Remote Desktop:"
          Write-Host "----------------------------------------"
          Write-Host "IP Address (Ø§Ù„Ø¹Ù†ÙˆØ§Ù†): $tailscaleIP"
          Write-Host "Username (Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…): $user"
          Write-Host "Password (ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±): $pass"
          Write-Host "========================================"
        shell: powershell
        
      # ğŸ’» 3. ØªØ«Ø¨ÙŠØª VS Code ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
      - name: ğŸ’» ØªØ«Ø¨ÙŠØª Visual Studio Code ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        run: |
          Write-Host "Ø¬Ø§Ø±ÙŠ ØªØ«Ø¨ÙŠØª VS Code..."
          $url = "https://update.code.visualstudio.com/latest/win32-x64-user/stable"
          $output = "$env:TEMP\VSCodeSetup.exe"
          Invoke-WebRequest -Uri $url -OutFile $output
          & $output /VERYSILENT /NORESTART
          Write-Host "ØªÙ… ØªØ«Ø¨ÙŠØª VS Code."
        shell: powershell

      # â¸ï¸ 4. Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ (Ù„Ù„Ø§ØªØµØ§Ù„)
      - name: â¸ï¸ Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø¢Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„
        run: |
          Start-Sleep -Seconds 21600 # 6 hours
        shell: powershell
