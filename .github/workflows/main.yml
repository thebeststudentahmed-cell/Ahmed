name: ๐ Windows RDP with Tailscale and VS Code (Robust IP Print)

on:
  workflow_dispatch:

jobs:
  rdp:
    runs-on: windows-latest
    
    steps:
      - name: โฌ๏ธ ูุญุต (Checkout) ุงูููุฏ
        uses: actions/checkout@v4

      # ๐ 1. ุชูุตูู ุจู Tailscale (ูุฐู ุงูุฎุทูุฉ ูู ุงูุชู ุชุซุจุช ุงูุฃุฏุงุฉ)
      - name: ๐ ุชูุตูู ุจู Tailscale
        uses: tailscale/github-action@v4
        with:
          oauth-client-id: ${{ secrets.TS_OAUTH_CLIENT_ID }}
          oauth-secret: ${{ secrets.TS_OAUTH_SECRET }}
          tags: tag:github-actions 
          hostname: github-rdp-runner

      # โ๏ธ 2. ุฅุนุฏุงุฏ ุงููุณุชุฎุฏู ูุทุจุงุนุฉ ุจูุงูุงุช ุงูุงุชุตุงู (ุงูุฎุทูุฉ ุงูููุนุฏูุฉ)
      - name: โ๏ธ ุฅุนุฏุงุฏ ูุทุจุงุนุฉ ูุนูููุงุช ุงูุงุชุตุงู
        run: |
          # ุจูุงูุงุช ุงููุณุชุฎุฏู
          $user = "RDP_User"
          $pass = "YourStrongPassword123" 
          net user $user $pass /add
          net localgroup administrators $user /add

          # ุชุญุฏูุฏ ูุณุงุฑ ุงูุฃุฏุงุฉ Tailscale ุงูุฐู ูุชู ุงุณุชุฎุฏุงูู ุจูุงุณุทุฉ GitHub Action
          $tsPath = (Get-Command tailscale).Source
          
          # ุงูุงูุชุธุงุฑ ููููุงู ูุถูุงู ุงุชุตุงู Tailscale ุจุงููุงูู (ููู)
          Start-Sleep -Seconds 5
          
          # ุทุจุงุนุฉ ุนููุงู IP ุงูุฎุงุต ุจู Tailscale ุจุงุณุชุฎุฏุงู ุงููุณุงุฑ ุงููุงูู
          $tailscaleIP = (& $tsPath ip -4)
          
          Write-Host "========================================"
          Write-Host "โ ุชู ุงูุชูุตูู ุจูุฌุงุญ ุจุดุจูุฉ Tailscale."
          Write-Host "โฌ๏ธ ุจูุงูุงุช ุงูุงุชุตุงู ุงููุทููุจุฉ ูู Remote Desktop:"
          Write-Host "----------------------------------------"
          Write-Host "IP Address (ุงูุนููุงู): $tailscaleIP"
          Write-Host "Username (ุงุณู ุงููุณุชุฎุฏู): $user"
          Write-Host "Password (ูููุฉ ุงููุฑูุฑ): $pass"
          Write-Host "----------------------------------------"
          Write-Host "๐ก ุชุฃูุฏ ูู ุฃู ุจุฑูุงูุฌ Tailscale ูุนูู ุนูู ุฌูุงุฒู ุงููุญูู."
          Write-Host "========================================"
        shell: powershell
        
      # ๐ป 3. ุชุซุจูุช VS Code ุชููุงุฆูุงู
      - name: ๐ป ุชุซุจูุช Visual Studio Code ุชููุงุฆูุงู
        run: |
          $url = "https://update.code.visualstudio.com/latest/win32-x64-user/stable"
          $output = "$env:TEMP\VSCodeSetup.exe"
          Invoke-WebRequest -Uri $url -OutFile $output
          & $output /VERYSILENT /NORESTART
        shell: powershell

      # โธ๏ธ 4. ุฅุจูุงุก ุงูุขูุฉ ุงูุงูุชุฑุงุถูุฉ ููุฏ ุงูุชุดุบูู (ููุงุชุตุงู)
      - name: โธ๏ธ ุฅุจูุงุก ุงูุขูุฉ ุงูุงูุชุฑุงุถูุฉ ููุฏ ุงูุชุดุบูู
        run: |
          Start-Sleep -Seconds 21600 # 6 hours
        shell: powershell
